// Gerador do Prisma
generator client {
  provider = "prisma-client-js"
}

// Fonte de dados - PostgreSQL
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Modelo de Usuário (Admin)
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      String   @default("admin") // 'admin' ou 'customer'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Modelo de Cliente
model Customer {
  id            Int           @id @default(autoincrement())
  name          String
  phone         String        @unique
  email         String?
  cpf           String?       @unique
  birthday      DateTime?
  notes         String?
  photo         String?       // URL ou caminho da foto
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  appointments  Appointment[]
  sales         Sale[]
  gallery       CustomerGallery[]
}

// Modelo de Galeria de Fotos do Cliente
model CustomerGallery {
  id          Int      @id @default(autoincrement())
  customerId  Int
  photoUrl    String
  description String?
  serviceDate DateTime? // Data do serviço realizado
  createdAt   DateTime @default(now())
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

// Modelo de Profissional
model Professional {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  phone     String?
  email     String?
  specialty String?  // especialidade (cabeleireiro, manicure, etc)
  photo     String?  // URL ou caminho da foto
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Modelo de Produto
model Product {
  id          Int        @id @default(autoincrement())
  name        String
  description String?
  price       Float
  stock       Int        @default(0)
  sku         String?    @unique
  photo       String?    // URL ou caminho da foto
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  saleItems   SaleItem[]
}

// Modelo de Serviço
model Service {
  id           Int           @id @default(autoincrement())
  name         String
  description  String?
  duration     Int           // duração em minutos
  price        Float
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  appointments Appointment[]
  saleItems    SaleItem[]
}

// Modelo de Agendamento
model Appointment {
  id               Int               @id @default(autoincrement())
  customerId       Int
  serviceId        Int
  date             DateTime
  status           String            @default("agendado") // 'agendado', 'confirmado', 'finalizado', 'cancelado', 'aguardando_confirmacao'
  professional     String?
  notes            String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  customer         Customer          @relation(fields: [customerId], references: [id], onDelete: Cascade)
  service          Service           @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  notificationLogs NotificationLog[]
}

// Modelo de Venda (PDV)
model Sale {
  id              Int        @id @default(autoincrement())
  customerId      Int?
  appointmentId   Int?       // ID do agendamento vinculado a esta venda
  professional    String?    // nome do profissional que realizou o atendimento
  total           Float
  paymentMethod   String     // 'DINHEIRO', 'CARTAO_CREDITO', 'CARTAO_DEBITO', 'PIX'
  installments    Int?       // número de parcelas (apenas para cartão de crédito)
  installmentValue Float?    // valor de cada parcela (apenas para cartão de crédito)
  date            DateTime   @default(now())
  notes           String?
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  customer        Customer?  @relation(fields: [customerId], references: [id], onDelete: SetNull)
  items           SaleItem[]
}

// Modelo de Item de Venda
model SaleItem {
  id        Int      @id @default(autoincrement())
  saleId    Int
  productId Int?
  serviceId Int?
  quantity  Int      @default(1)
  price     Float
  createdAt DateTime @default(now())
  sale      Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product   Product? @relation(fields: [productId], references: [id], onDelete: SetNull)
  service   Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
}

// Modelo de Log de Notificações
model NotificationLog {
  id            Int         @id @default(autoincrement())
  appointmentId Int
  message       String
  status        String      // 'enviado', 'erro', 'pendente'
  sentAt        DateTime    @default(now())
  errorMessage  String?
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
}

// Modelo de Despesas
model Expense {
  id        Int      @id @default(autoincrement())
  name      String
  category  String
  value     Float
  type      String   // 'FIXA' ou 'VARIAVEL'
  date      DateTime
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
